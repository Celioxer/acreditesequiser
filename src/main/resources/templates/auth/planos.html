<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Selecione seu Plano</title>
    <!-- ... Seus links de CSS e fontes -->
</head>
<body>

<div class="container">
    <h2>Selecione o seu plano</h2>

    <div th:if="${error}" class="alert alert-danger" role="alert">
        <p th:text="${error}"></p>
    </div>

    <!-- Este bloco é a chave: obtém o email do usuário logado -->
    <th:block th:with="userEmail=${#authentication.principal.username}">
        <div class="plan-card-container">
            <!-- Plano Básico -->
            <div class="plan-card">
                <h3>Plano Básico</h3>
                <div class="price">R$ 10,00<small>/mês</small></div>
                <p>Acesso completo por 30 dias.</p>
                <div class="btn-group">
                    <!-- Os botões agora redirecionam para a nova rota de assinatura -->
                    <a th:href="@{/assinatura/criar(plan='basic', email=${userEmail})}" class="btn btn-pix">Assinar</a>
                </div>
            </div>

            <!-- Plano Premium -->
            <div class="plan-card">
                <h3>Plano Premium</h3>
                <div class="price">R$ 10,00<small>/mês</small></div>
                <p>Acesso por 30 dias + Conteúdo Exclusivo.</p>
                <div class="btn-group">
                    <a th:href="@{/assinatura/criar(plan='premium', email=${userEmail})}" class="btn btn-pix">Assinar</a>
                </div>
            </div>
        </div>
    </th:block>
</div>

</body>
</html>