<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Processando seu Apoio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        body.auth-page { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; background-color: #f5f5f5; margin: 0; font-family: Arial, sans-serif; text-align: center; }
        .payment-container { width: 100%; max-width: 500px; padding: 40px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); border: 1px solid #ddd; }
        h2 { font-size: 1.8rem; color: #333; margin-bottom: 20px; }
        p { color: #555; font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #009ee3; animation: spin 1s ease infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="auth-page">

<div class="payment-container">
    <h2>Obrigado pelo seu apoio! ❤️</h2>
    <p>
        Seu pagamento foi aprovado. Estamos liberando seu acesso de apoiador.
        Você será redirecionado em instantes...
    </p>
    <div class="spinner"></div>
</div>

<script>
    // Este script irá verificar o status da assinatura a cada 3 segundos.
    const checkStatusInterval = setInterval(() => {
        fetch('/api/subscription/status')
            .then(response => response.json())
            .then(data => {
                console.log('Verificando status...', data);
                // Se o backend disser que o acesso está ativo, redirecionamos.
                if (data.active) {
                    clearInterval(checkStatusInterval); // Para o verificador
                    window.location.href = '/apoiadores'; // Redireciona para a página de sucesso
                }
            })
            .catch(error => {
                console.error('Erro ao verificar status:', error);
                // Opcional: parar após muitos erros
            });
    }, 3000); // Verifica a cada 3 segundos

    // Para garantir que não fique em loop infinito, paramos após 2 minutos.
    setTimeout(() => {
        clearInterval(checkStatusInterval);
        // Opcional: exibir uma mensagem de erro se demorar demais
        console.log('Tempo limite de verificação atingido.');
    }, 120000); // 2 minutos
</script>

</body>
</html>